# electoral-districts
Script for generation of the electoral districts 

Скрипт для построения одномандатных округов

## Необходимые инструменты

* python, make, wget, ogr2ogr

## Подготовка исходных данных

Для работы скрипта необходимо подготовить информацию о территориях одномандатных округов. Использовать скрипт имеет смысл, если территория каждого из округов почти всюду совпадает с границами муниципальных образований и/или городских районов, границы которых имеются в базе OpenStreetMap. 

### Файл с данными о территориях, которые целиком находятся в пределах избирательного округа
Сведения о муниципальных образованиях и/или гододских районах, которые целиком находятся в пределах избирательного округа указываются в файле `full.csv` в таком виде
| district      | osm_id | electoral_district |
|---------------|--------|--------------------|
| район Крюково |        | 1                  |
| район Куркино |        | 2                  |
|     ...       |  ...   | ...                |

в колонке *district* указывается название территории, как она указана в базе OpenStreetMap (тег name), в колонке *electoral_district* указывается номер округа, в который входит эта территория

### Файл с данными о территориях, которые разделены между несколькими избирательными округами
Сведения обо всех муниципальных образованиях и/или гододских районах, которые делятся на несколько частей границами избирательных округов необходимо внести в файл `splits.geojson`. В этом файле должен содержаться полигональный слой с атрибутами *district*, *osm_id*, *inside*, *outside*. Запись вида 
| district     | osm_id | inside | outside |
|--------------|--------|--------|---------|
| район Щукино |        |  3     |  5      |
|     ...      |  ...   | ...    | ...     |

означает, что часть района Щукино, содержащаяся внутри соответствующего полигона относится к округу № 3, а оставшаяся часть относится к округу № 5. Скрипт тестировался только для тех случаев, когда муниципальное образование и/или гододской район делится между двумя округами. Если район муниципальное образование и/или гододской район разделен между большим количеством округов, атрибут *outside* не нужно указывать (NULL).  В этом случае скрипт вроде тоже должен работать, но это не проверялось.

Если есть такая возможность, то лучше стараться так расположить полигоны, чтобы они не пересекались. Если этого добиться невозможно, то на получающихся избирательных округах могут появиться артефакты, которые лднако не влияют на правильность результата.

### Файл с дополнительными данными об избирательных округах
Дополнительные сведения об избирательных округов необходимо внести в файл `data.csv`. В нем обязательна должна быть колонка *electoral_district*. Информация из остальных колонок будет добавлена в качестве атрибутов в результирующий файл с избирательными округами.


### Файл с запросом overpass-turbo
Границы требуемых муниципальных образований и/или городских районов запрашиваются из базы OpenStreetMap с помощью сервиса [overpass-turbo](https://overpass-turbo.eu/). Соответствующий запрос должен содержаться в файле `overpass.txt`

## Использование скрипта
В каталог с файлами `Makefile` и `check.py` нужно поместить файл `overpass.txt` с текстом запроса к сервису overpass-turbo, файлы с описанием границ округов `full.csv`, `splits.geojson`, а также файл с дополнительной информацией `data.csv`.

Скрипт оформлен в виде Makefile'а. Для получения итогового файла достаточно выполнить команду *make* с каталоге, где расположены файлы. В самом конце будет выполнена проверка, все ли необходимые границы были скачаны с помощью запроса из файла `overpass.txt`. Если часть границ будет отсутствовать, то в конце выведется сообщение об этом.

## Примеры
Примеры исходных данных, для построение схемы одномандатных избирательных округов по выборам депутатов Московской городской Думы содержатся в каталогах MoscowCityDuma2014 и MoscowCityDuma2024. Там же содержится результат работы скрипта (файл `electoral_districts.geojson`) 
